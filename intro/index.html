

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Index &#8212; Dataset 0.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dataset" href="dataset.html" />
    <link rel="prev" title="Classes and capabilities" href="classes.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dataset.html" title="Dataset"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="classes.html" title="Classes and capabilities"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Dataset 0.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="classes.html" accesskey="U">Classes and capabilities</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Index</a><ul>
<li><a class="reference internal" href="#why-the-index-is-needed">Why the index is needed?</a></li>
<li><a class="reference internal" href="#datasetindex">DatasetIndex</a></li>
<li><a class="reference internal" href="#filesindex">FilesIndex</a><ul>
<li><a class="reference internal" href="#no-file-extensions">No file extensions</a></li>
<li><a class="reference internal" href="#sorting">Sorting</a></li>
<li><a class="reference internal" href="#directories">Directories</a></li>
<li><a class="reference internal" href="#numerous-sources">Numerous sources</a><ul>
<li><a class="reference internal" href="#creating-your-own-index-class">Creating your own index class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#constructor">Constructor</a></li>
<li><a class="reference internal" href="#build-index">build_index</a><ul>
<li><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="classes.html"
                        title="previous chapter">Classes and capabilities</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dataset.html"
                        title="next chapter">Dataset</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/intro/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="index">
<h1>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-the-index-is-needed">
<h2>Why the index is needed?<a class="headerlink" href="#why-the-index-is-needed" title="Permalink to this headline">¶</a></h2>
<p>A dataset may be so large that it does not fit into memory and thus you cannot process it at once. That is why each data item in the <cite>Dataset</cite> should have an unique id. It does not have to be meaningful (like a card number or a transaction id), sometimes it may be just a hash or an ordered number. However, each index item should address exactly one data item (which in turn can have a complex structure, like a list, an array, a dataframe, or even a graph).</p>
<p>The value of ids in the index is important only in 2 situations:</p>
<ul class="simple">
<li>in <cite>load</cite> <a class="reference external" href="batch#action-methods">action-method</a> , when batch gets data from some external source like <cite>batch_items = external_source[batch.indices]</cite> and thus the external source should contain those indices, otherwise <cite>load</cite> will fail. Similarly, when data is loaded from files, indices usually point to those files and their full paths (see <a class="reference internal" href="#filesindex">FilesIndex</a> below).</li>
<li>in item selection - <cite>batch[some_item_id]</cite> - so the index should contain the id you’re referring to.</li>
</ul>
<p>Evereywhere else the particular id value is pretty meaningless as all operations use an item position in the index, not its id.</p>
</div>
<div class="section" id="datasetindex">
<span id="id1"></span><h2>DatasetIndex<a class="headerlink" href="#datasetindex" title="Permalink to this headline">¶</a></h2>
<p><cite>DatasetIndex</cite> is a base index class which stores a sequence of unique ids for your data items. In the simplest case it might be just an ordered sequence of numbers (0, 1, 2, 3,…, e.g. <cite>numpy.arange(len(dataset))</cite>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_index</span> <span class="o">=</span> <span class="n">DatasetIndex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">my_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>In other cases it can be a list of domain-specific identificators (e.g. client ids, product codes, serial numbers, timestamps, etc).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_index</span> <span class="o">=</span> <span class="n">DatasetIndex</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;client_id&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>You will rarely need to work with an index directly, but if you want to do something specific you may use its <a class="reference internal" href="../api/dataset.index.html"><span class="doc">public API</span></a>.</p>
</div>
<div class="section" id="filesindex">
<span id="id2"></span><h2>FilesIndex<a class="headerlink" href="#filesindex" title="Permalink to this headline">¶</a></h2>
<p>When data comes from a file system, it might be convenient to use <cite>FilesIndex</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files_index</span> <span class="o">=</span> <span class="n">FilesIndex</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/some/files/*.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Thus <cite>files_index</cite> will contain the list of filenames that match a given mask.
The details of mask specification may be found in the <a class="reference external" href="https://docs.python.org/3/library/glob.html#glob.glob" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">glob()</span></code></a> documentation.</p>
<div class="section" id="no-file-extensions">
<h3>No file extensions<a class="headerlink" href="#no-file-extensions" title="Permalink to this headline">¶</a></h3>
<p>When filenames contain extensions which are not a part of the id, then they may be stripped with an option <cite>no_ext</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_index</span> <span class="o">=</span> <span class="n">FilesIndex</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/some/files/*.csv&quot;</span><span class="p">,</span> <span class="n">no_ext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="sorting">
<h3>Sorting<a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h3>
<p>Since order may be random, you may want to sort your index items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_index</span> <span class="o">=</span> <span class="n">FilesIndex</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/some/files/*.csv&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>However, this rarely makes any sense.</p>
</div>
<div class="section" id="directories">
<h3>Directories<a class="headerlink" href="#directories" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you need directories, not files. For instance, a CT images dataset includes one subdirectory per each patient, it is named with patient id and contains many images of that patient. So the index should be built from these subdirectories, and not separate images.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dirs_index</span> <span class="o">=</span> <span class="n">FilesIndex</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/archive/2016-*/scans/*&quot;</span><span class="p">,</span> <span class="n">dirs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <cite>dirs_index</cite> will contain a list of all subdirectories names.</p>
</div>
<div class="section" id="numerous-sources">
<h3>Numerous sources<a class="headerlink" href="#numerous-sources" title="Permalink to this headline">¶</a></h3>
<p>If files you are interested in are located in different places you may still build one united index:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_index</span> <span class="o">=</span> <span class="n">FilesIndex</span><span class="p">([</span><span class="s2">&quot;/current/year/data/*&quot;</span><span class="p">,</span> <span class="s2">&quot;/path/to/archive/2016/*&quot;</span><span class="p">,</span> <span class="s2">&quot;/previous/years/*&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="creating-your-own-index-class">
<h4>Creating your own index class<a class="headerlink" href="#creating-your-own-index-class" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="constructor">
<h3>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h3>
<p>We highly recommend to use the following pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyIndex</span><span class="p">(</span><span class="n">DatasetIndex</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">my_arg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># initialize new properties</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">my_arg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># do whatever you need</span>
</pre></div>
</div>
<p>So to summarize:</p>
<ol class="arabic simple">
<li>the parent class should be <cite>DatasetIndex</cite> or its child</li>
<li>include <cite>*args</cite> and <cite>**kwargs</cite> in the constructor definition</li>
<li>pass all the arguments to the parent constructor</li>
</ol>
</div>
<div class="section" id="build-index">
<h3>build_index<a class="headerlink" href="#build-index" title="Permalink to this headline">¶</a></h3>
<p>You might want to redefine <cite>build_index</cite> method which actually creates the index.
It takes all the arguments from the constructor and returns a numpy array with index items.
This method is called automatically from the <a class="reference internal" href="../api/dataset.index.html#dataset.DatasetIndex" title="dataset.DatasetIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatasetIndex</span></code></a> constructor.</p>
<div class="section" id="api">
<h4>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="../api/dataset.index.html"><span class="doc">Index API</span></a>.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dataset.html" title="Dataset"
             >next</a> |</li>
        <li class="right" >
          <a href="classes.html" title="Classes and capabilities"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Dataset 0.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="classes.html" >Classes and capabilities</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Analysis Center.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>